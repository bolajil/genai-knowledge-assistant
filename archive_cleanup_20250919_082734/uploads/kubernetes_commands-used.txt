 1  curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
    2  ls
    3  sudo apt install unzip
    4  ls
    5  unzip awscliv2.zip
    6  sudo ./aws/install
    7  aws -version
    8  aws --version
    9  aws configure
   10  $ curl -o kubectl https://s3.us-west-2.amazonaws.com/amazon-eks/1.21.2/2021-07-
   11  05/bin/linux/amd64/kubectl
   12  curl -o kubectl https://s3.us-west-2.amazonaws.com/amazon-eks/1.24.7/2022-10-31/bin/linux/amd64/kubectl
   13  PATH=$PATH:$HOME/bin
   14  echo 'export PATH=$PATH:$HOME/bin' >> ~/.bashrc
   15  kubectl version --short â€“client
   16  kubectl version
   17  kubectl version --short
   18  "https://github.com/weaveworks/eksctl/releases/latest/download/eksctl_$(uname -s)_amd64.tar.gz" | tar xz -C /tmp
   19  sudo mv /tmp/eksctl /usr/local/bin
   20  vi kubernetes-cluster.sh
   21  ls
   22  chmod +x kubernetes-cluster.sh
   23  ls
   24  ./kubernetes-cluster.sh
   25  kubectl get all
   26  kubectl get node
   27  kubectl get pod
   28  kubectl get ns
   29  kubectl run mypod --image=nginx:latest             --labels type=web             --dry-run=client -o yaml > mypod.yaml
   30  ls
   31  kubectl expose pod mypod     --port=80     --name mypod-service     --type=NodePort     --dry-run=client -o yaml > mypod-service.yaml
   32  ls
   33  kubectl create deployment mydeployment     --image=nginx:latest     --dry-run=client -o yaml > mydeployment.yaml
   34  ls
   35  vi mydeployment.yaml
   36  kubectl create -f kubectl create deployment mydeployment.yaml
   37  kubectl create -h
   38  ls
   39  kubectl apply -f mydeployment.yaml
   40  kubectl get all
   41  kubectl get all -o wide
   42  kubectl get nd -o wide
   43  kubectl get node -o wide
   44  ls
   45  vi mydeployment.yaml
   46  vi mypod-service.yaml
   47  vi mypod-service.yaml
   48  kubectl expose pod mypod     --port=80     --name mypod-service     --type=NodePort     --dry-run=client -o yaml > mypod-service.yaml
   49  kubectl expose pod mypod --port=80 --name mypod-service --type=NodePort --dry-run=client -o yaml > mypod-service.yaml
   50  kubectl get pod
   51  kubectl expose pod mydeployment --port=80 --name mypod-service --type=NodePort --dry-run=client -o yaml > mypod-service.yaml
   52  ls
   53  kubectl get pod
   54  vi mydeployment.yaml
   55  vi mypod-service.yaml
   56  rm mypod-service.yaml
   57  ls
   58  vi mypod.yaml
   59  vi mydeployment.yaml
   60  kubectl expose pod mydeployment --port=80 --name mypod-service --type=NodePort --dry-run=client -o yaml > mypod-service.yam
   61  kubectl create service nodeport mypod     --tcp=80:80     --node-port=30001     --dry-run=client -o yaml > mypod-service.yaml
   62  ls
   63  vi mypod-service.yam
   64  rm mypod-service.yam
   65  ls
   66  vi mypod-service.yaml
   67  kubectl get all
   68  ls
   69  vi mydeployment.yaml
   70  vi mypod-service.yaml
   71  kubectl apply -f mypod-service.yaml
   72  kubectl get all -o wide
   73  vi mypod-service.yaml
   74  kubectl apply -f mypod-service.yaml
   75  kubectl get all -o wide
   76  find / -iname nginx
   77  sudo find / -iname nginx
   78  kubectl get all -o wide
   79  kubectl exec -it pod/mydeployment-5c99b47898-74c5g /bin/bash
   80  ls
   81  kubectl get all -o wide
   82  curl 192.168.38.181
   83  kubectl get all -o wide
   84  ls
   85  vi mypod.yaml
   86  vi mydeployment.yaml
   87  vi kubernetes-delete.sh
   88  vi kubernetes-cluster.sh
   89  ls
   90  ls
   91  kubectl exec -it pod/mydeployment-5c99b47898-74c5g /bin/bash
   92  ls
   93  ./kubernetes-delete.sh
   94  ls
   95  ./kubernetes-cluster.sh
   96  helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
   97  helm repo add stable https://kubernetes-charts.storage.googleapis.com/
   98  helm repo add stable https://charts.helm.sh/stable
   99  helm install prometheus prometheus-community/kube-prometheus-stack
  100  helm install prometheus stable/prometheus-operator
  101  kubectl get pod
  102  kubectl get all
  103  kubectl get ns
  104  kubectl delete pod/prometheus-grafana-59c8c7bc9-6ffsq
  105  kubectl delete pod/prometheus-kube-prometheus-admission-patch-4vtx9
  106  kubectl delete pod/prometheus-kube-prometheus-operator-54c89f4cf8-6l4dm
  107  kubectl delete pod/prometheus-kube-state-metrics-54895c7d46-f5twr
  108  kubectl get all
  109  kubectl delete deployment.apps/prometheus-kube-state-metrics
  110  kubectl delete deployment.apps/prometheus-kube-prometheus-operator
  111  kubectl delete deployment.apps/prometheus-grafana
  112  kubectl get all
  113  ls
  114  ./kubernetes-delete.sh
  115  kubectl get all
  116  ./kubernetes-cluster.sh
  117  ls
  118  ./kubernetes-cluster.sh
  119  helm install prometheus prometheus-community/kube-prometheus-stack
  120  kubectl get all
  121  helm uninstall prometheus
  122  kubectl get all
  123  kubectl get pod
  124  kubectl delete prometheus-kube-prometheus-admission-patch-hxksj
  125  kubectl get pod
  126  kubectl delete pod  prometheus-kube-prometheus-admission-patch-hxksj
  127  kubectl get pod
  128  kubectl get all
  129  kubectl delete job.batch/prometheus-kube-prometheus-admission-patch
  130  kubectl delete pod  prometheus-kube-prometheus-admission-patch-hxksj
  131  kubectl get all
  132  helm install --name promtheus stable/prometheus
  133  kubectl get all
  134  kubectl create namespace prometheus
  135  helm install prometheus prometheus-community/prometheus     --namespace prometheus     --set alertmanager.persistentVolume.storageClass="gp2"     --set server.persistentVolume.storageClass="gp2"
  136  kubectl get all -n prometheus
  137  kubectl get all -n prometheus -watch
  138  kubectl get all -n prometheus watch
  139  kubectl get all -n prometheus
  140  ls
  141  ./kubernetes-delete.sh
  142  ls
  143  vi kubernetes-cluster.sh
  144  kubectl get all
  145  eksctl version
  146  eksctl completion bash >> ~/.bash_completion
  147  . /etc/profile.d/bash_completion.sh
  148  . ~/.bash_completion
  149  cat << EOF > eksworkshop.yaml
  150  ---
  151  apiVersion: eksctl.io/v1alpha5
  152  kind: ClusterConfig
  153  metadata:
  154    name: eksworkshop-eksctl
  155    region: ${AWS_REGION}
  156    version: "1.21"
  157  availabilityZones: ["${AZS[0]}", "${AZS[1]}", "${AZS[2]}"]
  158  managedNodeGroups:
  159  - name: nodegroup
  160    desiredCapacity: 3
  161    instanceType: t3.small
  162    ssh:
  163      enableSsm: true
  164  # To enable all of the control plane logs, uncomment below:
  165  # cloudWatch:
  166  #  clusterLogging:
  167  #    enableTypes: ["*"]
  168  secretsEncryption:
  169    keyARN: ${MASTER_ARN}
  170  EOF
  171  ls
  172  eksctl create cluster -f eksworkshop.yaml
  173  vi eksworkshop.yaml
  174  eksctl create cluster -f eksworkshop.yaml
  175  vi eksworkshop.yaml
  176  eksctl create cluster -f eksworkshop.yaml
  177  vi eksworkshop.yaml
  178  eksctl create cluster -f eksworkshop.yaml
  179  ls
  180  vi kubernetes-cluster.sh
  181  vi eksworkshop.yaml
  182  eksctl create cluster -f eksworkshop.yaml
  183  vi kubernetes-cluster.sh
  184  ./kubernetes-cluster.sh
  185  kubectl get all
  186  ls
  187  kubectl apply -f mydeployment.yaml
  188  kubectl get all
  189  kubectl create namespace prometheus
  190  helm install prometheus prometheus-community/prometheus     --namespace prometheus     --set alertmanager.persistentVolume.storageClass="gp2"     --set server.persistentVolume.storageClass="gp2"
  191  kubectl get all
  192  kubectl get all -n prometheus
  193  kubectl describe pod prometheus
  194  kubectl describe pvc prometheus
  195  kubectl get all -n prometheus
  196  kubectl get pv
  197  kubectl get all -n prometheus
  198  kubectl get pvc -n monitoring
  199  kubectl get pvc -n prometheus
  200  kubectl describe pvc prometheus
  201  kubectl get pvc -n prometheus
  202  kubectl describe pvc prometheus-alertmanager -n prometheus-server
  203  kubectl describe pvc prometheus-alertmanager -n prometheus
  204  kubectl apply -f https://raw.githubusercontent.com/kubernetes-sigs/aws-ebs-csi-driver/master/charts/aws-ebs-csi-driver/crds/snapshot-controller-crds.yaml
  205  helm install aws-ebs-csi-driver aws-ebs-csi-driver/aws-ebs-csi-driver                 --namespace kube-system                 --set enableVolumeResizing=true                 --set enableVolumeSnapshot=true                 --set serviceAccount.controller.create=true                 --set serviceAccount.controller.name=ebs-csi-controller-sa
  206  kubectl apply -f *logs* --namespace default
  207  ls
  208  vi kubernetes-cluster.sh
  209  helm uninstall prometheus
  210  kubectl describe pvc prometheus-alertmanager -n prometheus-server
  211  kubectl describe pvc prometheus-alertmanager -n prometheus
  212  kubectl get all
  213  kubectl get all -n prometheus
  214  kubectl get sv
  215  kubectl get ns
  216  helm delete ns prometheus
  217  kubectl get ns
  218  helm delete prometheus
  219  helm delete ns prometheus
  220  helm uninstall prometheus --namespace prometheus
  221  kubectl delete ns prometheus
  222  kubectl create namespace prometheus
  223  helm install prometheus prometheus-community/prometheus     --namespace prometheus \
  224  helm install prometheus prometheus-community/prometheus --namespace prometheus
  225  kubectl get all -n prometheus
  226  helm uninstall prometheus --namespace prometheus
  227  kubectl delete ns prometheus
  228  ls
  229  ./kubernetes-delete.sh
  230  vi kubernetes-cluster.sh
  231  aws eks --region us-east-2 update-kubeconfig --name demo-kubernetes-cluster
  232  ls
  233  vi kubernetes-cluster.sh
  234  curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3
  235  sudo chmod 700 get_helm.sh
  236  sudo ./get_helm.sh
  237  helm version --client
  238  ./kubernetes-cluster.sh
  239  helm install prometheus prometheus-community/kube-prometheus-stack
  240  kubectl --namespace default get pods -l "release=prometheus"
  241  kubectl get all
  242  kubect get configmap
  243  kubectl get configmap
  244  kubectl get secrete
  245  kubectl get secret
  246  kubectl get crd
  247  kubectl get statefulset
  248  kubectl describe statefulset prometheus-prometheus-kube-prometheus-prometheus > prom.yml
  249  kubectl describe statefulset alertmanager-prometheus-kube-prometheus-alertmanager > alert.yml
  250  kubectl get deployment
  251  kubectl port-forward deployment/prometheus-grafana 3000
  252  kubectl get ns grafana
  253  kubectl get ns
  254  kubectl get all
  255  vi deployment.apps/prometheus-grafana
  256  kubectl edit deployment.apps/prometheus-grafana
  257  kubectl get all
  258  vi deployment.apps/prometheus-grafana -n default
  259  ls
  260  kubectl edit deployment.apps/prometheus-grafana -n default
  261  helm uninstall prometheus
  262  kubectl get all
  263  kubectl create ns prometheus
  264  kubect get ns
  265  kubectl get ns
  266  helm install prometheus prometheus-community/kube-prometheus-stack -n prometheus
  267  kubectl get all -n prometheus
  268  kubectl get pod -n prometheus
  269  kubectl get svc -n prometheus
  270  kubectl edit svc prometheus-kube-prometheus-prometheus -n prometheus
  271  kubectl edit svc prometheus-grafana -n prometheus
  272  kubectl get svc -n prometheus
  273  ls
  274  kubectl apply -f mydeployment.yaml
  275  helm uninstall prometheus
  276  helm uninstall -n prometheus  prometheus
  277  kubectl get all -n prometheus
  278  kubectl get all
  279  ls
  280  ./kubernetes-delete.sh
  281  ls
  282  ./kubernetes-cluster.sh
  283  kubectl get pod
  284  kubectl get all
  285  kubectl get nodes
  286  kubectl get svc
  287  kubectl get sc
  288  curl -o example-iam-policy.json https://raw.githubusercontent.com/kubernetes-sigs/aws-ebscsi-driver/v0.9.0/docs/example-iam-policy.json
  289  aws iam create-policy --policy-name AmazonEKS_EBS_CSI_Driver --policy-document
  290  file://example-iam-policy.json
  291  aws iam create-policy --policy-name AmazonEKS_EBS_CSI_Driver --policy-document file://example-iam-policy.json
  292  ls
  293  aws iam create-policy --policy-name AmazonEKS_EBS_CSI_Driver --policy-document file://example-iam-policy.json
  294  ls
  295  cat example-iam-policy.json
  296  vi example-iam-policy.json
  297  aws iam create-policy --policy-name AmazonEKS_EBS_CSI_Driver --policy-document file://example-iam-policy.json
  298  ls
  299  rm example-iam-policy.json
  300  ls
  301  curl -o example-iam-policy.json https://github.com/kubernetes-sigs/aws-ebs-csi-driver/blob/master/docs/example-iam-policy.json
  302  ls
  303  aws iam create-policy --policy-name AmazonEKS_EBS_CSI_Driver --policy-document file://example-iam-policy.json
  304  ls
  305  rm example-iam-policy.json
  306  ls
  307  vi example-iam-policy.json
  308  aws iam create-policy --policy-name AmazonEKS_EBS_CSI_Driver --policy-document file://example-iam-policy.json
  309  kubectl -n kube-system describe configmap aws-auth
  310  aws iam attach-role-policy --policy-arn arn:aws:iam::945190701179:policy/AmazonEKS_EBS_CSI_Driver --role-name eksctl-demo-kubernetes-cluster-no-NodeInstanceRole-C09A819Q90JN
  311  kubectl apply -k "github.com/kubernetes-sigs/aws-ebs-csidriver/deploy/kubernetes/overlays/stable/?ref=master"
  312  kubectl apply "github.com/kubernetes-sigs/aws-ebs-csidriver/deploy/kubernetes/overlays/stable/?ref=master"
  313  kubectl apply -f "github.com/kubernetes-sigs/aws-ebs-csidriver/deploy/kubernetes/overlays/stable/?ref=master"
  314  kubectl apply -k "github.com/kubernetes-sigs/aws-ebs-csidriver/deploy/kubernetes/overlays/stable/?ref=master"
  315  kubectl apply -k "github.com/kubernetes-sigs/aws-ebs-csi-driver/deploy/kubernetes/overlays/stable/?ref=release-1.13"
  316  git clone https://github.com/kubernetes-sigs/aws-ebs-csi-driver.git
  317  ls
  318  cd aws-ebs-csi-driver/
  319  ls
  320  cd examples/
  321  ls
  322  cd kubernetes/
  323  ls
  324  cd dynamic-provisioning/
  325  ls
  326  cd manifests/
  327  ls
  328  vi storageclass.yaml
  329  vi claim.yaml
  330  vi pod.yaml
  331  kubectl apply -f manifests/
  332  cd ..
  333  kubectl apply -f manifests/
  334  kubectl get pvc
  335  kubectl get pv
  336  kubectl get pod
  337  kubectl descibe storageclass ebs-sc
  338  kubectl describe storageclass ebs-sc
  339  kubectl exec -it app cat /data/out.txt
  340  ls
  341  cd ..
  342  ls
  343  cd block-volume/
  344  ls
  345  cd manifests/
  346  ls
  347  vi claim.yaml
  348  vi pod.yaml
  349  vi storageclass.yaml
  350  cd ../..
  351  ls
  352  cd resizing/
  353  ls
  354  cd manifests/
  355  ls
  356  vi claim.yaml
  357  vi pod.yaml
  358  vi storageclass.yaml
  359  cd ../..
  360  ls
  361  cd snapshot/
  362  ls
  363  cd manifests/
  364  ls
  365  cd app/
  366  ls
  367  cd ..
  368  cd snapshot-restore/
  369  ls
  370  vi claim.yaml
  371  vi pod.yaml
  372  cd ../..
  373  ls
  374  cd ..
  375  ls
  376  vi static-provisioning/
  377  vi static-provisioning
  378  cd static-provisioning
  379  ls
  380  cd manifests/
  381  ls
  382  vi pv.yaml
  383  ls
  384  vi claim.yaml
  385  vi pod.yaml
  386  cd ../../..
  387  ls
  388  cd kubernetes/
  389  ls
  390  cd storageclass/
  391  ls
  392  cd manifests/
  393  ls
  394  vi storageclass.yaml
  395  vi claim.yaml
  396  vi pod.yaml
  397  cd ..
  398  ls
  399  cd ..
  400  ls
  401  cd windows
  402  ls
  403  cd specs/
  404  ls
  405  vi windows.yaml
  406  kubectl  get all -o wide
  407  kubectl  get sc all -o wide
  408  kubectl  get sc -o wide
  409  kubectl  get sc  ebs-sc -o wide
  410  aws iam detach-role-policy --policy-arn arn:aws:iam::945190701179:policy/AmazonEKS_EBS_CSI_Driver --role-name eksctl-demo-kubernetes-cluster-no-NodeInstanceRole-C09A819Q90JN
  411  history
  
ubuntu@ip-172-31-94-212: